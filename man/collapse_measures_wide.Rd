% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utilityFuncs.R
\name{collapse_measures_wide}
\alias{collapse_measures_wide}
\title{Collapse suffixed _A# variables and widen M-measure items (stable row order)}
\usage{
collapse_measures_wide(
  df,
  drop_suffix_pattern = "_A\\\\d+$",
  measure_prefix = "^M\\\\d+_",
  item_keep_pattern = NULL,
  fun.aggregate = NULL,
  return_tibble = TRUE,
  coerce_wide_numeric = FALSE,
  respondent_col = "Respondent_ID"
)
}
\arguments{
\item{df}{A data.frame or tibble.}

\item{drop_suffix_pattern}{Regex of suffixed columns to collapse. Default \code{"_A\\\\d+$"}.}

\item{measure_prefix}{Regex of measure columns. Default \code{"^M\\\\d+_"}.}

\item{item_keep_pattern}{Optional regex to keep only certain item codes after melt
(e.g., \code{"^Q\\\\d+[a-z]?$"}). If NULL, keep all.}

\item{fun.aggregate}{Optional function for \code{data.table::dcast} to resolve duplicates.}

\item{return_tibble}{Logical; return tibble if TRUE, else data.frame. Default TRUE.}

\item{coerce_wide_numeric}{Logical; try to coerce wide columns to numeric. Default FALSE.}

\item{respondent_col}{Name of the respondent identifier column. Default \code{"Respondent_ID"}.}
}
\value{
A tibble (default) or data.frame with suffixed columns collapsed, measures widened by item,
and rows ordered within each Respondent_ID by \code{Innsendt}/\code{Submitted} when available.
}
\description{
This function:
\enumerate{
\item Collapses columns that match a suffix pattern (default: \code{"_A\\\\d+$"}) into their base
names using ordered \code{coalesce} (higher digits preferred) with optional fallback to an
existing base column.
\item Auto-detects the measure code column: \code{"Kortkode"} or \code{"Short_code"}, copies it to a
stable internal column \code{.code}, and uses that for filtering and reshaping.
\item Treats columns matching \code{measure_prefix} (default: \code{"^M\\\\d+_"}) as measures; melts
long, filters rows where \code{.code} equals the measure prefix (e.g., \code{"M1172"}), then casts
wide so each item (substring after first underscore) becomes a column.
\item \strong{Critically:} enforces final row order so that within each \code{Respondent_ID}, rows are
ordered by \code{Innsendt} (if present) or else \code{Submitted}. If neither time column exists
or \code{Respondent_ID} is missing, a warning is issued and ordering is skipped.
}
}
