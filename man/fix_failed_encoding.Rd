% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utilityFuncs.R
\name{fix_failed_encoding}
\alias{fix_failed_encoding}
\title{Repair likely mojibake in character columns (UTF-8 mis-decoded as Latin-1/CP1252)}
\usage{
fix_failed_encoding(
  data,
  cols = NULL,
  from = c("latin1", "Windows-1252"),
  patterns = c("Ã.", "Â.", "â€™", "â€œ", "â€\\u009d", "â€“",
    "â€”", "â€¦", "Ã¥", "Ã¸", "Ã¦", "Ã…", "Ã˜", "Ã†"),
  quiet = FALSE,
  report = c("unique", "columns", "both", "none"),
  max_unique = 50,
  sanitize_invalid = TRUE
)
}
\arguments{
\item{data}{A data.frame (or tibble).}

\item{cols}{Optional tidyselect-style specification of columns to check. If
\code{NULL} (default), all character columns are checked.}

\item{from}{Candidate single-byte encodings to try for the byte round-trip.
Defaults to \code{c("latin1", "Windows-1252")}.}

\item{patterns}{Regex patterns treated as signals of mojibake.}

\item{quiet}{If \code{TRUE}, suppress console reporting.}

\item{report}{Console output mode: \code{"unique"} (default), \code{"columns"},
\code{"both"}, or \code{"none"}.}

\item{max_unique}{Maximum number of unique change rows to print (most frequent first).}

\item{sanitize_invalid}{If \code{TRUE} (default), attempts to sanitize invalid
UTF-8 strings for safer processing using \code{iconv(sub="byte")}.
This is conservative: it preserves problematic bytes as \if{html}{\out{<xx>}} escapes.}
}
\value{
A data.frame of the same class as \code{data} with repaired character columns.
}
\description{
Fixes common mojibake such as \code{"Helse FÃ¸rde"} (should be \code{"Helse Førde"})
caused by UTF-8 bytes being interpreted as Latin-1 / Windows-1252 at import.

The function returns a modified copy of \code{data}, suitable for piping, and
prints a console report. By default, the report is a summary of UNIQUE changes
(before -> after) with the number of instances across the whole data frame.
}
\examples{
df <- data.frame(
  org  = c("Helse FÃ¸rde", "Helse Vest", NA),
  note = c("smÃ¥", "OK", "Ã…lesund"),
  stringsAsFactors = FALSE
)
fix_failed_encoding(df)

Robust to real-world messy data: handles strings that are not valid UTF-8 by
performing detection in byte mode and using byte-safe summarization of changes.
}
